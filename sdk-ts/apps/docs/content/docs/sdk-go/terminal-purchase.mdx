---
title: Terminal Purchase
description: In-terminal payment flow for returning customers in Go
---

# Terminal Purchase

The terminal purchase flow allows returning customers to complete purchases without leaving the terminal. It uses OTP (one-time password) verification for security.

## When to Use

- Returning customers with saved payment methods
- Users who prefer staying in the terminal
- Automated/scripted purchase scenarios

For first-time purchases, use [Browser Checkout](/docs/sdk-go/browser-checkout) instead.

## Flow Overview

1. **Login** - Customer enters email, receives OTP via SMS
2. **Verify** - Customer enters OTP to authenticate
3. **Select Card** - Choose from saved payment methods
4. **Confirm** - Enter purchase OTP to complete

## Step-by-Step Implementation

### Step 1: Request Login OTP

```go
ctx := context.Background()

otp, err := sdk.RequestLoginOtp(ctx, "customer@example.com")
if err != nil {
    // Handle error - customer not found, etc.
    log.Fatal(err)
}

fmt.Printf("Enter the code sent to %s: ", otp.PhoneMasked)
```

### Step 2: Verify Login

```go
var code string
fmt.Scanln(&code)

login, err := sdk.VerifyLogin(ctx, "customer@example.com", otp.OtpID, code)
if err != nil {
    log.Fatal(err)
}

fmt.Printf("Logged in! Found %d existing licenses\n", len(login.Licenses))
```

### Step 3: Initialize Purchase

```go
purchase, err := sdk.InitTerminalPurchase(ctx)
if err != nil {
    log.Fatal(err)
}

fmt.Printf("Product: %s\n", purchase.ProductName)
fmt.Printf("Price: $%.2f %s\n", float64(purchase.Amount)/100, purchase.Currency)
fmt.Println("\nSaved cards:")
for i, card := range purchase.Cards {
    fmt.Printf("  %d. %s ending in %s (exp %d/%d)\n",
        i+1, card.Brand, card.Last4, card.ExpiryMonth, card.ExpiryYear)
}
```

### Step 4: Select Card and Request Purchase OTP

```go
var cardIdx int
fmt.Print("Select card: ")
fmt.Scanln(&cardIdx)

selectedCard := purchase.Cards[cardIdx-1]

otpID, _, err := sdk.RequestPurchaseOtp(ctx)
if err != nil {
    log.Fatal(err)
}

fmt.Printf("Enter the code sent to %s: ", purchase.PhoneMasked)
```

### Step 5: Confirm Purchase

```go
var purchaseCode string
fmt.Scanln(&purchaseCode)

result, err := sdk.ConfirmTerminalPurchase(ctx, selectedCard.ID, otpID, purchaseCode)
if err != nil {
    log.Fatal(err)
}

if result.Success {
    fmt.Println("Purchase complete!")
    fmt.Printf("Receipt: %s\n", result.ReceiptURL)
} else if result.RequiresAction {
    fmt.Printf("3D Secure required. Open: %s\n", result.ActionURL)
} else {
    fmt.Printf("Purchase failed: %s\n", result.Error)
}
```

## Types

### OtpRequestResult

```go
type OtpRequestResult struct {
    OtpID       string  // For verification
    PhoneMasked string  // e.g., "+1***5678"
    ExpiresIn   int     // Seconds until expiration
}
```

### LoginResult

```go
type LoginResult struct {
    IdentityToken string           // JWT for authenticated requests
    Licenses      []LicenseDetails // Customer's existing licenses
}
```

### PurchaseInitResult

```go
type PurchaseInitResult struct {
    Cards       []SavedCard
    Amount      int     // In cents
    Currency    string  // "usd", "eur", etc.
    PhoneMasked string
    ProductName string
}
```

### SavedCard

```go
type SavedCard struct {
    ID          string
    Brand       string  // "visa", "mastercard", etc.
    Last4       string
    ExpiryMonth int
    ExpiryYear  int
}
```

### PurchaseConfirmResult

```go
type PurchaseConfirmResult struct {
    Success        bool
    License        string  // License key if successful
    ReceiptURL     string
    RequiresAction bool    // 3D Secure required
    ActionURL      string  // URL for 3D Secure
    Error          string
}
```

## Complete Example

```go
package main

import (
    "bufio"
    "context"
    "fmt"
    "log"
    "os"
    "strconv"
    "strings"

    tuish "github.com/tuish/sdk-go"
)

func main() {
    sdk, _ := tuish.New(tuish.Config{
        ProductID: "prod_xxx",
        PublicKey: "MCowBQYDK2VwAyEA...",
        APIKey:    "sk_live_xxx",
    })

    ctx := context.Background()
    reader := bufio.NewReader(os.Stdin)

    // Get email
    fmt.Print("Email: ")
    email, _ := reader.ReadString('\n')
    email = strings.TrimSpace(email)

    // Request login OTP
    loginOtp, err := sdk.RequestLoginOtp(ctx, email)
    if err != nil {
        log.Fatalf("Login failed: %v", err)
    }

    // Verify login
    fmt.Printf("Enter code sent to %s: ", loginOtp.PhoneMasked)
    code, _ := reader.ReadString('\n')
    code = strings.TrimSpace(code)

    _, err = sdk.VerifyLogin(ctx, email, loginOtp.OtpID, code)
    if err != nil {
        log.Fatalf("Verification failed: %v", err)
    }
    fmt.Println("Logged in!")

    // Init purchase
    purchase, err := sdk.InitTerminalPurchase(ctx)
    if err != nil {
        log.Fatalf("Init purchase failed: %v", err)
    }

    fmt.Printf("\n%s - $%.2f\n\n", purchase.ProductName, float64(purchase.Amount)/100)
    fmt.Println("Saved cards:")
    for i, card := range purchase.Cards {
        fmt.Printf("  %d. %s ****%s\n", i+1, card.Brand, card.Last4)
    }

    // Select card
    fmt.Print("\nSelect card: ")
    cardStr, _ := reader.ReadString('\n')
    cardIdx, _ := strconv.Atoi(strings.TrimSpace(cardStr))
    card := purchase.Cards[cardIdx-1]

    // Request purchase OTP
    purchaseOtpID, _, err := sdk.RequestPurchaseOtp(ctx)
    if err != nil {
        log.Fatalf("OTP request failed: %v", err)
    }

    // Confirm purchase
    fmt.Printf("Enter code sent to %s: ", purchase.PhoneMasked)
    purchaseCode, _ := reader.ReadString('\n')
    purchaseCode = strings.TrimSpace(purchaseCode)

    result, err := sdk.ConfirmTerminalPurchase(ctx, card.ID, purchaseOtpID, purchaseCode)
    if err != nil {
        log.Fatalf("Purchase failed: %v", err)
    }

    if result.Success {
        fmt.Println("\nPurchase complete!")
        fmt.Printf("Receipt: %s\n", result.ReceiptURL)

        // Verify the new license
        license, _ := sdk.CheckLicense(ctx)
        fmt.Printf("License: %s\n", license.License.ID)
    } else {
        fmt.Printf("\nPurchase failed: %s\n", result.Error)
    }
}
```

## Error Handling

```go
otp, err := sdk.RequestLoginOtp(ctx, email)
if err != nil {
    if apiErr, ok := err.(*tuish.APIError); ok {
        switch apiErr.Code {
        case "CUSTOMER_NOT_FOUND":
            fmt.Println("No account with this email. Use browser checkout.")
        case "RATE_LIMITED":
            fmt.Println("Too many attempts. Try again later.")
        default:
            fmt.Printf("Error: %s\n", apiErr.Message)
        }
    }
    return
}
```

## See Also

- [Browser Checkout](/docs/sdk-go/browser-checkout) - For first-time purchases
- [TypeScript Terminal Purchase](/docs/sdk/terminal-purchase)
- [API Authentication](/docs/api/authentication) - OTP and identity tokens
